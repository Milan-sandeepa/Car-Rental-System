<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Driver | Online Booking</title>

    <meta name="keywords" content="Easy car rental private limited,online car rental">
    <meta name="description" content="This is a Easy Car Rental online booking system">
    <link href="assets/img/favicon.png" rel="icon" type="image/x-icon">
    <meta name="author" content="Online Car Booking Website">
    <meta name="owner" content="Milan Sandeepa">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--    <link rel="stylesheet" href="assets/css/bootstrap.min.css">-->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/layets.css">
    <link rel="stylesheet" href="assets/css/normalize.css">
    <link rel="stylesheet" href="assets/fonts/css/all.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">

</head>
<body>
<header class="fixed-top" id="header">
    <div>
        <nav class="navbar p-0 navbar-expand-lg navbar-dark bg-dark bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand ms-3" href="index.html"><img src="assets/img/logo.png" id="logo" alt="logo"></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link user" data-bs-toggle="dropdown-menu" data-bs-target="#navbarNav"
                               aria-current="page" href="#">
                                <img src="assets/img/icons/bell.png" alt="notify" class="icon">
                                <p class="count">1</p>
                            </a>
                            <div class="dropdown-menu" id="#navbarNav">
                                <div class="dp-main-menu">
                                    <a href="#" class="dropdown-item message-item">
                                        <img src="assets/img/icons/servers.png" alt="" class="user-note">
                                        <p>fggfdfgdfgdfgf</p>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link user" data-bs-toggle="dropdown" aria-current="page" href="#">
                                <img src="assets/img/icons/message.png" alt="notify" class="icon">
                                <p class="count">1</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link user" data-bs-toggle="dropdown" aria-current="page" href="#">
                                <img src="assets/img/icons/profile.png" alt="notify" class="icon">
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link user" data-bs-toggle="dropdown" aria-current="page" href="#">
                                <img src="assets/img/icons/settings.png" alt="notify" class="icon">
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <!--    Sidebar start-->
    <div class="left-menu d-none d-sm-block">
        <div class="menubar-content">
            <nav>
                <ul id="sidebar">
                    <li class="mt-2 d-flex justify-content-center" id="homeBtn">
                        <a href="adminDashboard.html" ><i class="fa-solid fa-house"></i>Dashboard</a>
                    </li>
                    <li id="requestBtn">
                        <a href="request.html"><i class="fa-solid fa-comment"></i>Request</a>
                    </li>
                    <li  id="carBtn">
                        <a href="car.html "><i class="fa-solid fa-car-side"></i>Car</a>
                    </li>
                    <li id="customerBtn">
                        <a href="customer.html"><i class="fa-solid fa-users"></i>Customer</a>
                    </li>
                    <li class="active" id="driverBtn">
                        <a href="driver.html"><i class="fa-solid fa-user"></i>Driver</a>
                    </li>
                    <li id="bookingBtn">
                        <a href="booking.html"><i class="fa-solid fa-book"></i>Booking</a>
                    </li>
                    <li id="incomeBtn">
                        <a href="#"><i class="fa-solid fa-dollar-sign"></i>Income</a>
                    </li>
                    <li id="settingBtn">
                        <a href="#"><i class="fa-solid fa-gear"></i>Setting</a>
                    </li>
                    <li id="signOutBtn">
                        <a href="#"><i class="fa-solid fa-right-from-bracket"></i>Sign Out</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <!--    Sidebar end-->
</header>

<!--Driver Start-->
<main class="container" id="driver-section">
    <div class="row">
        <div class="d-flex" style="margin-top: 25px;padding-left: 45px;padding-right: 19px;">
            <div class="col-6">
                <h4>Driver List</h4>
                <p>Manage your Drivers</p>
            </div>
            <div class="col-6 d-flex justify-content-end">
                <button class="btn h-75 mt-1 col-12 col-sm-6 col-md-6 col-xl-4" data-bs-toggle="modal" data-bs-target="#driverAddModal" style="background: #FF9F43;color: white;" >+ Add Driver</button>
            </div>
        </div>
    </div>

    <!--Add Driver Modal -->
    <div class="modal fade" id="driverAddModal" tabindex="-1" aria-labelledby="exampleDriverModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleDriverModalLabel">Add Driver</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <form id="driverAddForm">
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="DriverID" id="txtDriverId" name="driverID">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="Name" id="txtDriverName" name="name">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="Driver License No" id="txtDriverLicenseNo" name="licenseNo">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="Address" id="txtDriverAddress" name="address">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-list-numeric"></i></span>
                            <select class="form-control" id="txtDriverGender" name="gender">
                                <option value="None">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-address-book"></i></span>
                            <input type="text" class="form-control" placeholder="Contact" id="txtDriverContact" name="contact">
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-envelope"></i></span>
                            <input type="text" class="form-control" placeholder="Email" id="txtDriverEmail" name="email">
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-lock"></i></span>
                            <input type="password" class="form-control" placeholder="Password" id="txtDriverPass" name="password">
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary mt-3 col-12 col-sm-12 col-md-3 col-xl-2" type="button" id="driverAddBtn">Add</button>
                        </div>
                    </form>

                </div>

            </div>
        </div>
    </div>
    <!--Add Driver Modal end-->

    <!--Update Driver Modal -->
    <div class="modal fade" id="driverEditModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="editModalLabel">Update Driver</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="driverUpdateForm">
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="DriverID" id="txtUpdateDriverId" name="driverID">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="Name" id="txtUpdateDriverName" name="name">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="Driver License No" id="txtUpdateDriverLicenseNo" name="licenseNo">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="Address" id="txtUpdateDriverAddress" name="address">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-list-numeric"></i></span>
                            <select class="form-control" id="txtUpdateDriverGender" name="gender">
                                <option value="None">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-address-book"></i></span>
                            <input type="text" class="form-control" placeholder="Contact" id="txtUpdateDriverContact" name="contact">
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-envelope"></i></span>
                            <input type="text" class="form-control" placeholder="Email" id="txtUpdateDriverEmail" name="email">
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-lock"></i></span>
                            <input type="password" class="form-control" placeholder="Password" id="txtUpdateDriverPass" name="password">
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary mt-3 col-12 col-sm-12 col-md-3 col-xl-2" type="button" id="driverUpdateBtn">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!--Update Driver Modal end-->

    <section class="row">
        <div class="col-12 col-xl-12 mt-3 " style="padding-left: 35px;padding-right: 15px;">
            <div class=" bg-light border shadow rounded-3 p-4">
                <div>
                    <div class="col-12 col-sm-6 col-md-4 col-xl-3 d-flex justify-content-center align-items-center">
                        <i class="fa-solid fa-magnifying-glass" id="seachIconDriver"></i>
                        <input class="form-control" type="text" placeholder="Search.." id="searchDriverInput">
                    </div>
                    <div class="col mt-2 table-responsive pt-3" style="height: 470px; overflow-y: scroll">
                        <table class="table  table-hover">
                            <thead>
                            <tr class="table-primary">
                                <th scope="col">DriverID</th>
                                <th scope="col">Name</th>
                                <th scope="col">Licen No</th>
                                <th scope="col">Address</th>
                                <th scope="col">Gender</th>
                                <th scope="col">Contact</th>
                                <th scope="col">Email</th>
                                <th scope="col">Action</th>
                            </tr>
                            </thead>
                            <tbody id="tblDriver">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

</main>
<!--Driver End-->

<script src="assets/js/jquery-3.6.1.min.js"></script>
<!--<script src="assets/js/bootstrap.min.js"></script>-->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
        integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
        crossorigin="anonymous"></script>

<script>
    let baseUrl="http://localhost:8080/Car_Rental_System_war/";

    getAllDrivers();

    //Add Driver
    $("#driverAddBtn").click(function () {
        let formData = $("#driverAddForm").serialize();
        $.ajax({
            url: baseUrl+"driver",
            method: "post",
            data: formData,
            dataType: "json",
            success: function (res) {
                // invoked if the response status code is in 200 range
                console.log("Success Method Invoked")
                console.log(res);
                alert(res.message);
                getAllDrivers();
            },
            error: function (error) {
                // invokes if status code range is 500 range or 400 range
                console.log("Error Method Invoked");
                console.log(JSON.parse(error.responseText));
                alert(JSON.parse(error.responseText).message);

            }
        });

    });

    // Get all Driver Function
    function getAllDrivers() {
        $("#tblDriver").empty();
        $.ajax({
            url: baseUrl+"driver",
            success: function (res) {
                for (let c of res.data) {
                    let driverID = c.driverID;
                    let name = c.name;
                    let licenseNo = c.licenseNo;
                    let address = c.address;
                    let gender = c.gender;
                    let contact = c.contact;
                    let email = c.email;
                    let password = c.password;

                    let row = `<tr>

                        <td class="driverID">${driverID}</td>
                        <td class="name">${name}</td>
                        <td>${licenseNo}</td>
                        <td>${address}</td>
                        <td>${gender}</td>
                        <td >${contact}</td>
                        <td >${email}</td>
                        <td><i class="editIconDriver fa-solid fa-pen-to-square" data-bs-toggle="modal"data-bs-target="#driverEditModal"></i>
                        <i class="deleteIconDriver fa-solid fa-trash" style="margin-left: 10px"></i></td>

                        </tr>`;

                    $("#tblDriver").append(row);
                }
                bindRowClickEvents();
            },
            error: function (error) {
                let message = JSON.parse(error.responseText).message;
                alert(message);
            }
        });
    }

    function bindRowClickEvents() {
        $(".editIconDriver").click(function () {

            // Find the row
            var row = $(this).closest("tr");

            // Find the text
            var searchID = row.find(".driverID").text();


            if (searchID!=null){
                $.ajax({
                    url: baseUrl+"driver",
                    success: function (res) {
                        for (let c of res.data) {

                            if (c.driverID == searchID) {
                                $('#txtUpdateDriverId').val(c.driverID);
                                $('#txtUpdateDriverName').val(c.name);
                                $('#txtUpdateDriverLicenseNo').val(c.licenseNo);
                                $('#txtUpdateDriverAddress').val(c.address);
                                $('#txtUpdateDriverGender').val(c.gender);
                                $('#txtUpdateDriverContact').val(c.contact);
                                $('#txtUpdateDriverEmail').val(c.email);
                                // $('#txtUpdateUserConPwd').val(c.userPwd);
                            }
                        }
                    },
                    error: function (error) {
                        let message = JSON.parse(error.responseText).message;
                        alert(message);
                    }
                });



            }else {
                alert("No such Driver to edit. please try Again");
            }

            var searchName = row.find(".name").text();
            if (searchID!=null){
                $.ajax({
                    url: baseUrl+"user",
                    success: function (res) {
                        for (let c of res.data) {
                            console.log(c)
                            if (c.username == searchName) {
                                $('#txtUpdateDriverPass').val(c.password);
                            }
                        }
                    },
                    error: function (error) {
                        let message = JSON.parse(error.responseText).message;
                        alert(message);
                    }
                });



            }else {
                alert("No such customer to edit. please try Again");
            }

        });

        $(".deleteIconDriver").click(function () {

            // Find the row
            var row = $(this).closest("tr");

            // Find the text
            var id = row.find(".driverID").text();

            let option = confirm("Do you really want to delete Driver Id :" + id);

            if (option){
                $.ajax({
                    url: baseUrl+"driver?id=" + id,
                    method: "delete",
                    success: function (resp) {
                        getAllDrivers();
                        alert(resp.message);
                    },
                    error: function (error) {
                        let message = JSON.parse(error.responseText).message;
                        alert(message);
                    }
                });
            }
        });
    }

    $("#driverUpdateBtn").click(function () {
        let res = confirm("Do you want to add this Update Driver.?");
        if (res) {

            let driverID =$('#txtUpdateDriverId').val();
            let name =$('#txtUpdateDriverName').val();
            let licenseNo =$('#txtUpdateDriverLicenseNo').val();
            let address =$('#txtUpdateDriverAddress').val();
            let gender =$('#txtUpdateDriverGender').val();
            let contact =$('#txtUpdateDriverContact').val();
            let email =$('#txtUpdateDriverEmail').val();
            let password =$('#txtUpdateDriverPass').val();


            var driverOb = {
                driverID: driverID,
                name: name,
                licenseNo: licenseNo,
                address: address,
                gender: gender,
                contact: contact,
                email: email,
                password: password,
            }

            $.ajax({
                url: baseUrl+"driver",
                method: "put",
                contentType: "application/json",
                data: JSON.stringify(driverOb),
                dataType: "json",
                success: function (resp) {
                    getAllDrivers();
                    alert(resp.message);
                },
                error: function (error) {
                    let message = JSON.parse(error.responseText).message;
                    alert(message);
                }
            });

        }else {
            alert("Update Failed..!");
        }
    });

</script>
</body>
</html>