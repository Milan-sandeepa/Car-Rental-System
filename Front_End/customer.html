<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Customer | Online Booking</title>

    <meta name="keywords" content="Easy car rental private limited,online car rental">
    <meta name="description" content="This is a Easy Car Rental online booking system">
    <link href="assets/img/favicon.png" rel="icon" type="image/x-icon">
    <meta name="author" content="Online Car Booking Website">
    <meta name="owner" content="Milan Sandeepa">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--    <link rel="stylesheet" href="assets/css/bootstrap.min.css">-->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/layets.css">
    <link rel="stylesheet" href="assets/css/normalize.css">
    <link rel="stylesheet" href="assets/fonts/css/all.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
</head>
<body>
<header class="fixed-top" id="header">
    <div>
        <nav class="navbar p-0 navbar-expand-lg navbar-dark bg-dark bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand ms-3" href="index.html"><img src="assets/img/logo.png" id="logo" alt="logo"></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link user" data-bs-toggle="dropdown-menu" data-bs-target="#navbarNav"
                               aria-current="page" href="#">
                                <img src="assets/img/icons/bell.png" alt="notify" class="icon">
                                <p class="count">1</p>
                            </a>
                            <div class="dropdown-menu" id="#navbarNav">
                                <div class="dp-main-menu">
                                    <a href="#" class="dropdown-item message-item">
                                        <img src="assets/img/icons/servers.png" alt="" class="user-note">
                                        <p>fggfdfgdfgdfgf</p>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link user" data-bs-toggle="dropdown" aria-current="page" href="#">
                                <img src="assets/img/icons/message.png" alt="notify" class="icon">
                                <p class="count">1</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link user" data-bs-toggle="dropdown" aria-current="page" href="#">
                                <img src="assets/img/icons/profile.png" alt="notify" class="icon">
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link user" data-bs-toggle="dropdown" aria-current="page" href="#">
                                <img src="assets/img/icons/settings.png" alt="notify" class="icon">
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <!--    Sidebar start-->
    <div class="left-menu d-none d-sm-block">
        <div class="menubar-content">
            <nav>
                <ul id="sidebar">
                    <li class="mt-2 d-flex justify-content-center" id="homeBtn">
                        <a href="adminDashboard.html" ><i class="fa-solid fa-house"></i>Dashboard</a>
                    </li>
                    <li id="requestBtn">
                        <a href="request.html"><i class="fa-solid fa-comment"></i>Request</a>
                    </li>
                    <li  id="carBtn">
                        <a href="car.html "><i class="fa-solid fa-car-side"></i>Car</a>
                    </li>
                    <li class="active" id="customerBtn">
                        <a href="customer.html"><i class="fa-solid fa-users"></i>Customer</a>
                    </li>
                    <li id="driverBtn">
                        <a href="driver.html"><i class="fa-solid fa-user"></i>Driver</a>
                    </li>
                    <li id="bookingBtn">
                        <a href="booking.html"><i class="fa-solid fa-book"></i>Booking</a>
                    </li>
                    <li id="incomeBtn">
                        <a href="#"><i class="fa-solid fa-dollar-sign"></i>Income</a>
                    </li>
                    <li id="settingBtn">
                        <a href="#"><i class="fa-solid fa-gear"></i>Setting</a>
                    </li>
                    <li id="signOutBtn">
                        <a href="#"><i class="fa-solid fa-right-from-bracket"></i>Sign Out</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <!--    Sidebar end-->
</header>

<!--Customer Start-->
<main class="container" id="customer-section">
    <div class="row">
        <div class="d-flex" style="margin-top: 25px;padding-left: 45px;padding-right: 19px;">
            <div class="col-6">
                <h4>Customer List</h4>
                <p>Manage your Customers</p>
            </div>
            <div class="col-6 d-flex justify-content-end">
                <button class="btn h-75 mt-1 col-12 col-sm-6 col-md-6 col-xl-4" data-bs-toggle="modal" data-bs-target="#customerAddModal" style="background: #FF9F43;color: white;" >+ Add Customer</button>
            </div>
        </div>
    </div>

    <!--Add Customer Modal -->
    <div class="modal fade" id="customerAddModal" tabindex="-1" aria-labelledby="exampleCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleCustomerModalLabel">Add Customer</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <form id="customerAddForm">
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="Name" id="txtUserName" name="name">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-list-numeric"></i></span>
                            <select class="form-control" id="txtUserGender" name="gender">
                                <option value="None">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-address-book"></i></span>
                            <input type="text" class="form-control" placeholder="Address" id="txtUserAddress" name="address">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-phone"></i></span>
                            <input type="text" class="form-control" placeholder="Contact Number" id="txtUserContact"
                                   name="contact">
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-envelope"></i></span>
                            <input type="text" class="form-control" placeholder="Email" id="txtUserEmail" name="email">
                        </div>

                        <!--image upload section start-->
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-list-numeric"></i></span>
                            <input type="text" class="form-control" placeholder="Nic/License Number" id="txtUserNic" name="nic/licenseNo">
                            <span class="input-group-text"><i class="fa fa-file"></i></span>
                            <input id="file-1" type="file" name="nic/licensePhoto" class="form-control" placeholder="Nic Photo Upload here">
                        </div>
                        <!--image upload section end-->

                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-lock"></i></span>
                            <input type="password" class="form-control" placeholder="Password" id="txtUserPwd" name="userPwd">
                        </div>
                    </form>

<!--                    <form id="customerAddForm">-->
<!--                        <div>-->
<!--                            <div class="form-group ms-2 me-2">-->
<!--                                <label for="txtCusId">CID</label>-->
<!--                                <input class="form-control" id="txtCusId" type="text">-->
<!--                                <span class="control-error" id="lblCusId"></span>-->
<!--                            </div>-->
<!--                            <div class="form-group ms-2 me-2">-->
<!--                                <label for="txtCusName">Name</label>-->
<!--                                <input class="form-control" id="txtCusName" type="text">-->
<!--                                <span class="control-error" id="lblCusName"></span>-->
<!--                            </div>-->
<!--                            <div class="form-group ms-2 me-2">-->
<!--                                <label for="txtCusNic">NIC</label>-->
<!--                                <input class="form-control" id="txtCusNic" type="text">-->
<!--                                <span class="control-error" id="lblCusNic"></span>-->
<!--                            </div>-->
<!--                            <div class="form-group ms-2 me-2">-->
<!--                                <label for="txtCusGender">Gender</label>-->
<!--                                <input class="form-control" id="txtCusGender" type="text">-->
<!--                                <span class="control-error" id="lblCusGender"></span>-->
<!--                            </div>-->
<!--                            <div class="form-group ms-2 me-2">-->
<!--                                <label for="txtCusAddress">Address</label>-->
<!--                                <input class="form-control" id="txtCusAddress" type="text">-->
<!--                                <span class="control-error" id="lblCusAddress"></span>-->
<!--                            </div>-->
<!--                            <div class="form-group ms-2 me-2">-->
<!--                                <label for="txtCusContact">Contact</label>-->
<!--                                <input class="form-control" id="txtCusContact" type="text">-->
<!--                                <span class="control-error" id="lblCusContact"></span>-->
<!--                            </div>-->
<!--                            <div class="form-group ms-2 me-2">-->
<!--                                <label for="txtCusEmail">Email</label>-->
<!--                                <input class="form-control" id="txtCusEmail" type="text">-->
<!--                                <span class="control-error" id="lblCusEmail"></span>-->
<!--                            </div>-->
<!--                            <div class="form-group ms-2 me-2">-->
<!--                                <label for="txtCusPwd">Password</label>-->
<!--                                <input class="form-control" id="txtCusPwd" type="text">-->
<!--                                <span class="control-error" id="lblCusPwd"></span>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </form>-->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary mt-3 col-12 col-sm-12 col-md-3 col-xl-2" type="button" id="customerAddBtn">Add</button>

                </div>
            </div>
        </div>
    </div>
    <!--Add Customer Modal end-->

    <!--Update Customer Modal -->
    <div class="modal fade" id="customerEditModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="editModalLabel">Update Customer</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="customerUpdateForm">
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-user"></i></span>
                            <input type="text" class="form-control" placeholder="Name" id="txtUpdateUserName" name="name">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-list-numeric"></i></span>
                            <select class="form-control" id="txtUpdateUserGender" name="gender">
                                <option value="None">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-address-book"></i></span>
                            <input type="text" class="form-control" placeholder="Address" id="txtUpdateUserAddress" name="address">
                        </div>
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-phone"></i></span>
                            <input type="text" class="form-control" placeholder="Contact Number" id="txtUpdateUserContact"
                                   name="contact">
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-envelope"></i></span>
                            <input type="text" class="form-control" placeholder="Email" id="txtUpdateUserEmail" name="email">
                        </div>

                        <!--image upload section start-->
                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-list-numeric"></i></span>
                            <input type="text" class="form-control" placeholder="Nic/License Number" id="txtUpdateUserNic" name="nic/licenseNo">
                            <span class="input-group-text"><i class="fa fa-file"></i></span>
                            <input id="file-2" type="file" name="nic/licensePhoto" class="form-control" placeholder="Nic Photo Upload here">
                        </div>
                        <!--image upload section end-->

                        <div class="input-group mb-3">
                            <span class="input-group-text"><i class="fa fa-lock"></i></span>
                            <input type="password" class="form-control" placeholder="Password" id="txtUpdateUserPwd" name="userPwd">
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary mt-3 col-12 col-sm-12 col-md-3 col-xl-2" type="button" id="customerUpdateBtn">Update</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!--Update Customer Modal end-->

    <section class="row">
        <div class="col-12 col-xl-12 mt-3 " style="padding-left: 35px;padding-right: 15px;">
            <div class=" bg-light border shadow rounded-3 p-4">
                <div>
                    <div class="col-12 col-sm-6 col-md-4 col-xl-3 d-flex justify-content-center align-items-center">
                        <i class="fa-solid fa-magnifying-glass" id="seachIconCustomer"></i>
                        <input class="form-control" type="text" placeholder="Search.." id="searchCustomerInput">
                    </div>
                    <div class="col mt-2 table-responsive pt-3" style="height: 470px; overflow-y: scroll">
                        <table class="table  table-hover">
                            <thead>
                            <tr class="table-primary">
                                <th scope="col">Name</th>
                                <th scope="col">Gender</th>
                                <th scope="col">Address</th>
                                <th scope="col">Contact</th>
                                <th scope="col">Email</th>
                                <th scope="col">NIC/LICENSE No</th>
                                <th scope="col">Photo</th>
                                <th scope="col">Action</th>
                            </tr>
                            </thead>
                            <tbody id="tblCustomer">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
<!--Customer End-->

<script src="assets/js/jquery-3.6.1.min.js"></script>
<!--<script src="assets/js/bootstrap.min.js"></script>-->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
        integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
        crossorigin="anonymous"></script>

<script>
    let baseUrl="http://localhost:8080/Car_Rental_System_war/";

    getAllCustomers();

    //Add User
    $("#customerAddBtn").click(function () {

        let formData = new FormData();

        let name = $("#txtUserName").val();
        let gender = $("#txtUserGender").val();
        let address = $("#txtUserAddress").val();
        let contact = $("#txtUserContact").val();
        let email = $("#txtUserEmail").val();
        let nicNo = $("#txtUserNic").val();
        let userPwd = $("#txtUserPwd").val();

        formData.append("name",name);
        formData.append("gender",gender);
        formData.append("address",address);
        formData.append("contact",contact);
        formData.append("email",email);
        formData.append("nicNo",nicNo);
        formData.append("userPwd",userPwd);

        let file1 = $("#file-1")[0].files[0];
        let fileName1 = $("#file-1")[0].files[0].name;

        formData.append("nic/licensePhoto",file1,fileName1);

        $.ajax({
            url: baseUrl + "customer",
            method: "post",
            data: formData,
            dataType: "json",
            async: true,
            contentType: false,
            processData: false,
            enctype:"multipart/form-data",
            success: function (res) {
                // invoked if the response status code is in 200 range
                console.log("Success Method Invoked")
                console.log(res);
                alert(res.message);
                getAllCustomers();

            },
            error: function (error) {
                // invokes if status code range is 500 range or 400 range
                console.log("Error Method Invoked");
                console.log(JSON.parse(error.responseText));
                alert(JSON.parse(error.responseText).message);

            }
        });

    });

    //Get all Customer Function
    function getAllCustomers() {
        console.log("success load");
        $("#tblCustomer").empty();

        $.ajax({
            url: baseUrl+"customer",
            success: function (res) {
                console.log(res)
                for (let c of res.data) {
                    let name = c.name;
                    let gender = c.gender;
                    let address = c.address;
                    let contact = c.contact;
                    let email = c.email;
                    let nicNo = c.nicNo;
                    let nic_Photo = c.nic_Photo;

                    let row = `<tr>

                        <td class="name">${name}</td>
                        <td>${gender}</td>
                        <td>${address}</td>
                        <td>${contact}</td>
                        <td>${email}</td>
                        <td class="nic">${nicNo}</td>
                        <td><img src="${baseUrl + nic_Photo}" width="100px"></td>

                        <td><i class="editIconCustomer fa-solid fa-pen-to-square" data-bs-toggle="modal"data-bs-target="#customerEditModal"></i>
                        <i class="deleteIconCustomer fa-solid fa-trash" style="margin-left: 10px"></i></td>

                        </tr>`;



                    $("#tblCustomer").append(row);
                }
                bindRowClickEvents();
                // setTextFieldValues("", "", "", "");
            },
            error: function (error) {
                let message = JSON.parse(error.responseText).message;
                alert(message);
            }
        });
    }

    function bindRowClickEvents() {
        $(".editIconCustomer").click(function () {

            // Find the row
            var row = $(this).closest("tr");

            // Find the text
            var searchID = row.find(".nic").text();


            if (searchID!=null){
                $.ajax({
                    url: baseUrl+"customer",
                    success: function (res) {
                        for (let c of res.data) {
                            console.log(c)
                            if (c.nicNo == searchID) {
                                $('#txtUpdateUserName').val(c.name);
                                $('#txtUpdateUserGender').val(c.gender);
                                $('#txtUpdateUserAddress').val(c.address);
                                $('#txtUpdateUserContact').val(c.contact);
                                $('#txtUpdateUserEmail').val(c.email);
                                $('#txtUpdateUserNic').val(c.nicNo);
                                // $('#txtUpdateUserPwd').val(c.userPwd);
                                // $('#txtUpdateUserConPwd').val(c.userPwd);
                            }
                        }
                    },
                    error: function (error) {
                        let message = JSON.parse(error.responseText).message;
                        alert(message);
                    }
                });



            }else {
                alert("No such customer to edit. please try Again");
            }

            var searchName = row.find(".name").text();
            if (searchID!=null){
                $.ajax({
                    url: baseUrl+"user",
                    success: function (res) {
                        for (let c of res.data) {
                            if (c.username == searchName) {

                                $('#txtUpdateUserPwd').val(c.password);
                            }
                        }
                    },
                    error: function (error) {
                        let message = JSON.parse(error.responseText).message;
                        alert(message);
                    }
                });



            }else {
                alert("No such customer to edit. please try Again");
            }

        });

        $(".deleteIconCustomer").click(function () {

            // Find the row
            var row = $(this).closest("tr");

            // Find the text
            var id = row.find(".nic").text();

            let option = confirm("Do you really want to delete Customer Nic :" + id);

            if (option){
                $.ajax({
                    url: baseUrl+"customer?id=" + id,
                    method: "delete",
                    success: function (resp) {
                        getAllCustomers();
                        alert(resp.message);
                    },
                    error: function (error) {
                        let message = JSON.parse(error.responseText).message;
                        alert(message);
                    }
                });
            }
        });
    }

    $("#customerUpdateBtn").click(function () {
        let res = confirm("Do you want to add this Update Customer.?");
        if (res) {

            let name =$('#txtUpdateUserName').val();
            let gender =$('#txtUpdateUserGender').val();
            let address =$('#txtUpdateUserAddress').val();
            let contact =$('#txtUpdateUserContact').val();
            let email =$('#txtUpdateUserEmail').val();
            let nic_licenseNo =$('#txtUpdateUserNic').val();
            let userPwd =$('#txtUpdateUserPwd').val();


            var customerOb = {
                name: name,
                gender: gender,
                address: address,
                contact: contact,
                email: email,
                nicNo: nic_licenseNo,
                userPwd: userPwd,
            }

            $.ajax({
                url: baseUrl+"customer",
                method: "put",
                contentType: "application/json",
                data: JSON.stringify(customerOb),
                dataType: "json",
                success: function (resp) {
                    getAllCustomers();
                    alert(resp.message);
                },
                error: function (error) {
                    let message = JSON.parse(error.responseText).message;
                    alert(message);
                }
            });

        }else {
            alert("Update Failed..!");
        }
    });


    // customer search bar
    $(document).ready(function (){
        $("#searchCustomerInput").on('keyup',function (){
            var value = $(this).val().toLowerCase();

            $("#tblCustomer>tr").filter(function (){
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });
    });

</script>
</body>
</html>